<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.35, maximum-scale=2.0, user-scalable=yes">
    <title>창건샘의 김밥교실</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .role-card {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* 타이머 스타일 */
        .timer-display {
            font-family: 'Courier New', monospace;
            font-size: 3.5rem;
            font-weight: bold;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .timer-ending {
            animation: pulse 1s infinite;
            color: #ef4444;
        }
        
        /* 돌림판 스타일 */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .spinning {
            animation: spin 3s cubic-bezier(0.17, 0.67, 0.83, 0.67);
        }
        
        /* 13인치 크롬북 최적화 - 한 화면에 3개 카드 표시 */
        body {
            font-size: 100%;
            zoom: 0.53;  /* 39% 크기로 조정 - 크롬북에서 최적의 가독성과 화면 활용 */
            transform-origin: top left;
        }
        
        /* 브라우저 호환성을 위한 추가 설정 */
        @media screen {
            html {
                zoom: 1.35;
            }
        }
        

    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-50 to-blue-50">
    <!-- Navigation -->
    <nav class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-sushi text-3xl"></i>
                    <h1 class="text-2xl font-bold">창건샘의 김밥교실</h1>
                </div>
                <div class="text-sm opacity-90">
                    <span id="currentTime"></span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content - 가로 3분할 레이아웃 -->
    <div class="w-full px-2 py-1">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-3 items-stretch max-w-7xl mx-auto">
            
            <!-- 야채김밥 (타이머) - 왼쪽 -->
            <div class="bg-white rounded-2xl shadow-xl p-4 flex flex-col justify-between">
                <div class="text-center mb-8">
                    <div class="inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-3">
                        <i class="fas fa-stopwatch text-3xl text-green-600"></i>
                    </div>
                    <h2 class="text-xl font-bold text-gray-800">🥕 야채김밥</h2>
                </div>

                <!-- 타이머 설정 -->
                <div class="mb-4">
                    <div class="flex space-x-2 items-center justify-center">
                        <div class="text-center">
                            <input type="number" id="timerMinutes" min="0" max="99" value="5" 
                                   class="w-20 px-2 py-2 text-center border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-xl font-bold">
                            <p class="text-sm text-gray-500 mt-1 font-semibold">분</p>
                        </div>
                        <span class="text-3xl font-bold text-gray-400">:</span>
                        <div class="text-center">
                            <input type="number" id="timerSeconds" min="0" max="59" value="0" 
                                   class="w-20 px-2 py-2 text-center border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-xl font-bold">
                            <p class="text-sm text-gray-500 mt-1 font-semibold">초</p>
                        </div>
                    </div>
                </div>

                <!-- 타이머 디스플레이 -->
                <div class="mb-8 text-center">
                    <div id="timerDisplay" class="timer-display text-green-600" style="font-size: 4.5rem;">
                        05:00
                    </div>
                    <div id="timerStatus" class="text-lg text-gray-500 mt-2 font-semibold">
                        대기 중
                    </div>
                </div>

                <!-- 타이머 컨트롤 버튼 -->
                <div class="flex space-x-2 mb-8">
                    <button id="startTimer" onclick="startTimer()" 
                            class="flex-1 bg-green-500 text-white font-bold py-3 rounded-lg hover:bg-green-600 transition text-base">
                        <i class="fas fa-play mr-2"></i>시작
                    </button>
                    <button id="pauseTimer" onclick="pauseTimer()" 
                            class="flex-1 bg-yellow-500 text-white font-bold py-3 rounded-lg hover:bg-yellow-600 transition hidden text-base">
                        <i class="fas fa-pause mr-2"></i>일시정지
                    </button>
                    <button id="resetTimer" onclick="resetTimer()" 
                            class="flex-1 bg-gray-500 text-white font-bold py-3 rounded-lg hover:bg-gray-600 transition text-base">
                        <i class="fas fa-redo mr-2"></i>리셋
                    </button>
                </div>

                <!-- 빠른 설정 버튼 -->
                <div class="grid grid-cols-3 gap-2 mb-0">
                    <button onclick="setQuickTimeSeconds(20)" class="py-3 px-3 bg-gray-100 rounded-lg hover:bg-gray-200 text-sm font-semibold">
                        20초
                    </button>
                    <button onclick="setQuickTimeSeconds(30)" class="py-3 px-3 bg-gray-100 rounded-lg hover:bg-gray-200 text-sm font-semibold">
                        30초
                    </button>
                    <button onclick="setQuickTimeSeconds(40)" class="py-3 px-3 bg-gray-100 rounded-lg hover:bg-gray-200 text-sm font-semibold">
                        40초
                    </button>
                    <button onclick="setQuickTimeSeconds(50)" class="py-3 px-3 bg-gray-100 rounded-lg hover:bg-gray-200 text-sm font-semibold">
                        50초
                    </button>
                    <button onclick="setQuickTimeSeconds(60)" class="py-3 px-3 bg-gray-100 rounded-lg hover:bg-gray-200 text-sm font-semibold">
                        60초
                    </button>
                    <button onclick="setQuickTimeSeconds(90)" class="py-3 px-3 bg-gray-100 rounded-lg hover:bg-gray-200 text-sm font-semibold">
                        90초
                    </button>
                </div>
            </div>

            <!-- 참치김밥 (학생 로그인) - 가운데 -->
            <div class="bg-white rounded-2xl shadow-xl p-4 flex flex-col justify-between">
                <div id="loginSection">
                    <div class="text-center mb-8">
                        <div class="inline-flex items-center justify-center w-16 h-16 bg-purple-100 rounded-full mb-3">
                            <i class="fas fa-user-graduate text-3xl text-purple-600"></i>
                        </div>
                        <h2 class="text-xl font-bold text-gray-800">🐟 참치김밥</h2>
                    </div>

                    <form onsubmit="studentLogin(event)">
                        <div class="mb-12">
                            <label class="block text-base font-bold text-gray-700 mb-3">
                                <i class="fas fa-id-card mr-2 text-purple-500"></i>학번
                            </label>
                            <input type="text" id="loginStudentId" 
                                   placeholder="예: 4103" 
                                   pattern="[0-9]{4}"
                                   maxlength="4"
                                   required
                                   class="w-full px-4 py-4 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-xl text-center font-bold">
                        </div>

                        <div class="mb-12">
                            <label class="block text-base font-bold text-gray-700 mb-3">
                                <i class="fas fa-user mr-2 text-purple-500"></i>이름
                            </label>
                            <input type="text" id="loginStudentName" 
                                   placeholder="예: 김선호" 
                                   required
                                   class="w-full px-4 py-4 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-xl text-center font-bold">
                        </div>

                        <button type="submit" 
                                class="w-full bg-gradient-to-r from-purple-500 to-purple-600 text-white font-bold py-4 rounded-lg hover:opacity-90 transition transform hover:scale-105 text-lg mb-12">
                            <i class="fas fa-arrow-right mr-2"></i>학생 로그인
                        </button>
                    </form>
                </div>

                    <!-- Teacher Login Button -->
                    <div class="pt-4 border-t border-gray-200 text-center mb-0">
                        <button onclick="showTeacherLogin()" 
                                class="text-gray-500 hover:text-gray-700 text-xs underline">
                            <i class="fas fa-user-shield mr-1"></i>선생님 로그인
                        </button>
                    </div>
            </div>

            <!-- 치즈김밥 (돌림판) - 오른쪽 -->
            <div class="bg-white rounded-2xl shadow-xl p-4 flex flex-col justify-between">
                <div class="text-center mb-8">
                    <div class="inline-flex items-center justify-center w-16 h-16 bg-yellow-100 rounded-full mb-3">
                        <i class="fas fa-dice text-3xl text-yellow-600"></i>
                    </div>
                    <h2 class="text-xl font-bold text-gray-800">🧀 치즈김밥</h2>
                </div>

                <!-- 항목 입력 영역 -->
                <div class="mb-8">
                    <div class="flex items-center justify-between mb-2">
                        <label class="text-xs font-semibold text-gray-700">돌림판 항목</label>
                        <div class="flex space-x-1">
                            <select id="savedListsSelect" onchange="loadSelectedList()" 
                                    class="text-xs border rounded px-2 py-1 max-w-20">
                                <option value="">불러오기</option>
                            </select>
                            <button onclick="refreshSavedLists()" class="text-xs text-blue-600 hover:text-blue-800">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    <textarea id="wheelItems" 
                            placeholder="항목을 입력하세요 (한 줄에 하나씩)&#10;예:&#10;1번&#10;2번&#10;3번" 
                            class="w-full px-2 py-2 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 text-xs"
                            rows="3">1번
2번
3번
4번
5번</textarea>
                    <div class="mt-1 flex space-x-2">
                        <button onclick="clearWheel()" class="flex-1 bg-gray-200 text-gray-700 px-2 py-1 rounded text-xs hover:bg-gray-300">
                            <i class="fas fa-eraser mr-1"></i>초기화
                        </button>
                    </div>
                </div>

                <!-- 뽑는 갯수 입력 -->
                <div class="mb-4">
                    <label class="text-xs font-semibold text-gray-700 block mb-2">뽑는 갯수</label>
                    <input type="number" id="pickCount" min="1" max="10" value="1" 
                           class="w-full px-2 py-1 border rounded text-xs text-center"
                           placeholder="뽑을 개수를 입력하세요">
                </div>

                <!-- 돌림판 영역 -->
                <div class="relative mb-8" style="height: 220px;">
                    <!-- Canvas for wheel -->
                    <canvas id="wheelCanvas" width="210" height="210" 
                            class="mx-auto cursor-pointer"
                            style="display: block;">
                    </canvas>
                </div>

                <!-- 돌리기 버튼 -->
                <button onclick="spinWheel()" id="spinButton"
                        class="w-full bg-gradient-to-r from-yellow-400 to-yellow-500 text-white font-bold py-2 rounded-lg hover:opacity-90 transition transform hover:scale-105 text-sm mb-0">
                    <i class="fas fa-sync-alt mr-2"></i>돌리기!
                </button>
            </div>
        </div>

        <!-- Role Display Section (Hidden by default) -->
        <div id="roleSection" class="hidden mt-6">
            <!-- Student Info Header -->
            <div class="bg-white rounded-xl shadow-lg p-4 mb-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="bg-purple-100 rounded-full p-3">
                            <i class="fas fa-user text-purple-600 text-xl"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">학생 정보</p>
                            <p class="text-lg font-semibold">
                                <span id="displayStudentId" class="text-purple-600"></span> 
                                <span id="displayStudentName" class="text-gray-800 ml-2"></span>
                            </p>
                        </div>
                    </div>
                    <button onclick="logout()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-sign-out-alt mr-1"></i>로그아웃
                    </button>
                </div>
            </div>

            <!-- No Role Message -->
            <div id="noRoleMessage" class="hidden">
                <div class="bg-yellow-50 border-2 border-yellow-200 rounded-xl p-8 text-center">
                    <i class="fas fa-hourglass-half text-6xl text-yellow-500 mb-4"></i>
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">아직 배정된 역할이 없습니다</h3>
                    <p class="text-gray-600">선생님께서 역할을 배부하면 여기에 표시됩니다.</p>
                    <p class="text-sm text-gray-500 mt-2">자동으로 30초마다 확인합니다...</p>
                    <button onclick="checkRoleAgain()" class="mt-4 bg-yellow-500 text-white px-6 py-2 rounded-lg hover:bg-yellow-600 transition">
                        <i class="fas fa-sync-alt mr-2"></i>지금 확인
                    </button>
                </div>
            </div>


        </div>
    </div>

    <!-- Teacher Login Modal -->
    <div id="teacherLoginModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl max-w-md w-full p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-800">
                        <i class="fas fa-user-shield text-purple-500 mr-2"></i>선생님 로그인
                    </h3>
                    <button onclick="closeTeacherLogin()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <form onsubmit="teacherLogin(event)">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">비밀번호</label>
                        <input type="password" id="teacherPassword" 
                               placeholder="비밀번호를 입력하세요" 
                               required
                               class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <button type="submit" 
                            class="w-full bg-purple-500 text-white font-bold py-2 rounded-lg hover:bg-purple-600 transition">
                        <i class="fas fa-sign-in-alt mr-2"></i>로그인
                    </button>
                </form>
                <p class="text-sm text-gray-500 mt-4 text-center">
                    관리자 페이지로 이동합니다
                </p>
            </div>
        </div>
    </div>

    <!-- Timer Complete Modal -->
    <div id="timerCompleteModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl max-w-md w-full p-8">
                <div class="text-center">
                    <div class="inline-flex items-center justify-center w-20 h-20 bg-green-100 rounded-full mb-4">
                        <i class="fas fa-bell text-4xl text-green-600 animate-bounce"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">⏰ 시간이 종료되었습니다!</h3>
                    <p class="text-gray-600 mb-6">설정한 시간이 모두 끝났습니다.</p>
                    <button onclick="confirmTimerComplete()" 
                            class="bg-green-500 text-white px-8 py-3 rounded-lg hover:bg-green-600 transition text-lg font-bold">
                        <i class="fas fa-check mr-2"></i>확인
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen">
            <div class="bg-white rounded-lg p-8 text-center">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500 mx-auto mb-4"></div>
                <p class="text-gray-700">역할을 확인하는 중...</p>
            </div>
        </div>
    </div>

    <!-- Error Modal -->
    <div id="errorModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl max-w-md w-full p-6">
                <div class="text-center">
                    <i class="fas fa-exclamation-circle text-5xl text-red-500 mb-4"></i>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">확인 실패</h3>
                    <p class="text-gray-600 mb-6" id="errorMessage">학번과 이름을 다시 확인해주세요.</p>
                    <button onclick="closeError()" class="bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600 transition">
                        확인
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Audio for timer alarm -->
    <audio id="timerAlarm" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBzuS2Oy9diMFl2MSBwFViahqWDM4cFvrrk1gao3Cvu+EKaOileaNIBI6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==" type="audio/wav">
    </audio>

    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Database Configuration -->
    <script src="js/supabase-config.js"></script>
    
    <!-- Timer JavaScript -->
    <script>
        // Timer variables
        let timerInterval = null;
        let alarmInterval = null;
        let totalSeconds = 0;
        let remainingSeconds = 0;
        let isTimerRunning = false;
        let isPaused = false;

        // Update timer display
        function updateTimerDisplay() {
            const minutes = Math.floor(remainingSeconds / 60);
            const seconds = remainingSeconds % 60;
            const display = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            document.getElementById('timerDisplay').textContent = display;
            
            // Change color when time is running out (last 10 seconds)
            if (remainingSeconds <= 10 && remainingSeconds > 0 && isTimerRunning) {
                document.getElementById('timerDisplay').classList.add('timer-ending');
            } else {
                document.getElementById('timerDisplay').classList.remove('timer-ending');
            }
        }

        // Start timer
        function startTimer() {
            if (isTimerRunning && !isPaused) return;
            
            if (!isPaused) {
                // Get time from inputs
                const minutes = parseInt(document.getElementById('timerMinutes').value) || 0;
                const seconds = parseInt(document.getElementById('timerSeconds').value) || 0;
                totalSeconds = minutes * 60 + seconds;
                remainingSeconds = totalSeconds;
                
                if (totalSeconds === 0) {
                    alert('시간을 설정해주세요!');
                    return;
                }
            }
            
            isTimerRunning = true;
            isPaused = false;
            
            // Update UI
            document.getElementById('startTimer').classList.add('hidden');
            document.getElementById('pauseTimer').classList.remove('hidden');
            document.getElementById('timerStatus').textContent = '진행 중...';
            document.getElementById('timerMinutes').disabled = true;
            document.getElementById('timerSeconds').disabled = true;
            
            // Start countdown
            timerInterval = setInterval(() => {
                if (remainingSeconds > 0) {
                    remainingSeconds--;
                    updateTimerDisplay();
                } else {
                    // Timer complete
                    completeTimer();
                }
            }, 1000);
        }

        // Pause timer
        function pauseTimer() {
            if (!isTimerRunning) return;
            
            isPaused = true;
            isTimerRunning = false;
            clearInterval(timerInterval);
            
            // Update UI
            document.getElementById('pauseTimer').classList.add('hidden');
            document.getElementById('startTimer').classList.remove('hidden');
            document.getElementById('timerStatus').textContent = '일시정지';
        }

        // Reset timer
        function resetTimer() {
            clearInterval(timerInterval);
            // Stop continuous alarm if running
            if (alarmInterval) {
                clearInterval(alarmInterval);
                alarmInterval = null;
            }
            isTimerRunning = false;
            isPaused = false;
            remainingSeconds = 0;
            
            // Update UI
            document.getElementById('startTimer').classList.remove('hidden');
            document.getElementById('pauseTimer').classList.add('hidden');
            document.getElementById('timerStatus').textContent = '대기 중';
            document.getElementById('timerMinutes').disabled = false;
            document.getElementById('timerSeconds').disabled = false;
            document.getElementById('timerDisplay').classList.remove('timer-ending');
            
            // Reset to input values
            const minutes = parseInt(document.getElementById('timerMinutes').value) || 5;
            const seconds = parseInt(document.getElementById('timerSeconds').value) || 0;
            remainingSeconds = minutes * 60 + seconds;
            updateTimerDisplay();
        }

        // Complete timer
        function completeTimer() {
            clearInterval(timerInterval);
            isTimerRunning = false;
            isPaused = false;
            
            // Play alarm sound (딩동딩동딩동) - first time
            playAlarmSound();
            
            // Start continuous alarm (repeat every 3 seconds)
            alarmInterval = setInterval(() => {
                playAlarmSound();
            }, 3000);
            
            // Show completion modal
            document.getElementById('timerCompleteModal').classList.remove('hidden');
            
            // Update UI
            document.getElementById('timerStatus').textContent = '완료!';
            document.getElementById('timerDisplay').classList.add('timer-ending');
        }

        // Play alarm sound
        function playAlarmSound() {
            // Create oscillator for 딩동 sound
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            function playDingDong(delay) {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // 딩 (high note)
                oscillator.frequency.setValueAtTime(880, audioContext.currentTime + delay);
                // 동 (low note)
                oscillator.frequency.setValueAtTime(440, audioContext.currentTime + delay + 0.2);
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime + delay);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + delay + 0.4);
                
                oscillator.start(audioContext.currentTime + delay);
                oscillator.stop(audioContext.currentTime + delay + 0.4);
            }
            
            // Play 딩동 3 times
            playDingDong(0);
            playDingDong(0.5);
            playDingDong(1);
        }

        // Confirm timer complete
        function confirmTimerComplete() {
            // Stop continuous alarm
            if (alarmInterval) {
                clearInterval(alarmInterval);
                alarmInterval = null;
            }
            
            document.getElementById('timerCompleteModal').classList.add('hidden');
            resetTimer();
        }

        // Quick time set in seconds
        function setQuickTimeSeconds(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            document.getElementById('timerMinutes').value = minutes;
            document.getElementById('timerSeconds').value = secs;
            remainingSeconds = seconds;
            updateTimerDisplay();
        }

        // Update display when inputs change
        document.getElementById('timerMinutes').addEventListener('input', function() {
            if (!isTimerRunning) {
                const minutes = parseInt(this.value) || 0;
                const seconds = parseInt(document.getElementById('timerSeconds').value) || 0;
                remainingSeconds = minutes * 60 + seconds;
                updateTimerDisplay();
            }
        });

        document.getElementById('timerSeconds').addEventListener('input', function() {
            if (!isTimerRunning) {
                const minutes = parseInt(document.getElementById('timerMinutes').value) || 0;
                const seconds = parseInt(this.value) || 0;
                remainingSeconds = minutes * 60 + seconds;
                updateTimerDisplay();
            }
        });

        // Initialize timer display
        document.addEventListener('DOMContentLoaded', function() {
            const minutes = parseInt(document.getElementById('timerMinutes').value) || 5;
            const seconds = parseInt(document.getElementById('timerSeconds').value) || 0;
            remainingSeconds = minutes * 60 + seconds;
            updateTimerDisplay();
        });
    </script>
    
    <!-- Wheel/Roulette JavaScript -->
    <script>
        // 돌림판 변수들
        let wheelItems = [];
        let currentRotation = 0;
        let isSpinning = false;
        let wheelCanvas = null;
        let wheelContext = null;
        let selectedArrowCount = 1;
        let selectedIndices = [];

        // 돌림판 초기화
        document.addEventListener('DOMContentLoaded', function() {
            wheelCanvas = document.getElementById('wheelCanvas');
            if (wheelCanvas) {
                wheelContext = wheelCanvas.getContext('2d');
                initWheel();
                drawWheel();
            }
        });

        // 돌림판 초기화
        function initWheel() {
            const savedItems = localStorage.getItem('wheelItems');
            if (savedItems) {
                document.getElementById('wheelItems').value = savedItems;
            }
            updateWheelItems();
        }



        // 항목 업데이트
        function updateWheelItems() {
            const textarea = document.getElementById('wheelItems');
            const text = textarea.value.trim();
            if (text) {
                wheelItems = text.split('\n').filter(item => item.trim() !== '');
            } else {
                wheelItems = ['1', '2', '3', '4', '5'];
            }
            drawWheel();
        }

        // 돌림판 그리기
        let highlightedIndex = -1;
        
        function drawWheel() {
            if (!wheelContext || wheelItems.length === 0) return;

            const centerX = wheelCanvas.width / 2;
            const centerY = wheelCanvas.height / 2;
            const radius = 95;

            // Clear canvas
            wheelContext.clearRect(0, 0, wheelCanvas.width, wheelCanvas.height);

            // 색상 배열
            const colors = [
                '#FBBF24', '#FB923C', '#F87171', '#A78BFA',
                '#60A5FA', '#34D399', '#FDE047', '#FDBA74',
                '#FCA5A5', '#C084FC', '#93C5FD', '#6EE7B7'
            ];

            const anglePerItem = (Math.PI * 2) / wheelItems.length;

            // 각 섹션 그리기
            wheelItems.forEach((item, index) => {
                const startAngle = index * anglePerItem - Math.PI / 2 + currentRotation;
                const endAngle = startAngle + anglePerItem;

                // 섹션 그리기
                wheelContext.beginPath();
                wheelContext.arc(centerX, centerY, radius, startAngle, endAngle);
                wheelContext.lineTo(centerX, centerY);
                
                // 선택된 섹션들 강조
                wheelContext.fillStyle = colors[index % colors.length];
                wheelContext.fill();
                
                if (selectedIndices.includes(index)) {
                    // 강조 효과 - 더 굵은 테두리와 색상 변화
                    wheelContext.strokeStyle = '#DC2626';  // 빨간색 테두리
                    wheelContext.lineWidth = 5;
                    
                    // 추가 강조 효과 - 내부 원
                    wheelContext.beginPath();
                    wheelContext.arc(centerX, centerY, radius - 10, startAngle, endAngle);
                    wheelContext.lineTo(centerX, centerY);
                    wheelContext.fillStyle = 'rgba(220, 38, 38, 0.3)';  // 반투명 빨간색
                    wheelContext.fill();
                } else {
                    wheelContext.strokeStyle = '#fff';
                    wheelContext.lineWidth = 2;
                }
                wheelContext.stroke();

                // 텍스트 그리기
                wheelContext.save();
                wheelContext.translate(centerX, centerY);
                wheelContext.rotate(startAngle + anglePerItem / 2);
                wheelContext.textAlign = 'center';
                wheelContext.fillStyle = '#1F2937';
                wheelContext.font = 'bold 14px sans-serif';
                wheelContext.fillText(item, radius * 0.7, 0);
                wheelContext.restore();
            });

            // 중앙 원
            wheelContext.beginPath();
            wheelContext.arc(centerX, centerY, 20, 0, Math.PI * 2);
            wheelContext.fillStyle = '#fff';
            wheelContext.fill();
            wheelContext.strokeStyle = '#374151';
            wheelContext.lineWidth = 2;
            wheelContext.stroke();
            
            // 중앙 점
            wheelContext.beginPath();
            wheelContext.arc(centerX, centerY, 3, 0, Math.PI * 2);
            wheelContext.fillStyle = '#374151';
            wheelContext.fill();
        }
        
        // 랜덤으로 뽑기 (설정된 개수만큼)
        function getRandomSelections() {
            const pickCount = parseInt(document.getElementById('pickCount').value) || 1;
            const maxPick = Math.min(pickCount, wheelItems.length);
            
            const availableIndices = Array.from({length: wheelItems.length}, (_, i) => i);
            const selectedIndices = [];
            
            // 중복 없이 랜덤 선택
            for (let i = 0; i < maxPick; i++) {
                const randomIndex = Math.floor(Math.random() * availableIndices.length);
                selectedIndices.push(availableIndices[randomIndex]);
                availableIndices.splice(randomIndex, 1);
            }
            
            return selectedIndices.sort((a, b) => a - b);
        }

        function highlightSelectedSections() {
            drawWheel();
            
            // 3초 후 강조 해제
            setTimeout(() => {
                selectedIndices = [];
                drawWheel();
            }, 3000);
        }

        // 돌림판 돌리기
        function spinWheel() {
            if (isSpinning) return;
            
            const textarea = document.getElementById('wheelItems');
            updateWheelItems();
            
            if (wheelItems.length < 2) {
                alert('최소 2개 이상의 항목을 입력해주세요!');
                return;
            }

            isSpinning = true;
            document.getElementById('spinButton').disabled = true;

            // 회전 각도 계산 (3-4회전 + 랜덤)
            const spins = 3 + Math.random();
            const randomAngle = Math.random() * Math.PI * 2;
            const totalRotation = spins * Math.PI * 2 + randomAngle;

            // 애니메이션
            let startTime = null;
            const duration = 3000 + Math.random() * 1000; // 3-4초

            function animate(timestamp) {
                if (!startTime) startTime = timestamp;
                const progress = (timestamp - startTime) / duration;

                if (progress < 1) {
                    // easeOut 효과
                    const easeOut = 1 - Math.pow(1 - progress, 3);
                    currentRotation = totalRotation * easeOut;
                    drawWheel();
                    requestAnimationFrame(animate);
                } else {
                    currentRotation = totalRotation;
                    drawWheel();
                    
                    // 랜덤으로 뽑기 (화살표 위치와 무관)
                    const resultIndices = getRandomSelections();
                    const selectedItems = resultIndices.map(index => wheelItems[index]);

                    // 결과 처리
                    setTimeout(() => {
                        // 알림음
                        playWheelSound();
                        
                        // 선택된 섹션들 강조 표시
                        selectedIndices = resultIndices;
                        highlightSelectedSections();
                        
                        // 팝업으로 결과 표시
                        showResultPopup(selectedItems);
                        
                        
                        isSpinning = false;
                        document.getElementById('spinButton').disabled = false;
                    }, 500);
                }
            }

            requestAnimationFrame(animate);
        }

        // 돌림판 소리
        function playWheelSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.3);
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        }

        // 저장
        function saveWheel() {
            const items = document.getElementById('wheelItems').value;
            localStorage.setItem('wheelItems', items);
            updateWheelItems();
            
            // 알림
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-check mr-1"></i>저장됨!';
            btn.classList.add('bg-green-500', 'text-white');
            btn.classList.remove('bg-gray-200', 'text-gray-700');
            
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.classList.remove('bg-green-500', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            }, 1500);
        }

        // 초기화
        function clearWheel() {
            document.getElementById('wheelItems').value = '1번\n2번\n3번\n4번\n5번';
            updateWheelItems();
        }

        // 저장된 목록 불러오기
        function loadSavedWheel() {
            const savedLists = {
                '번호뽑기': Array.from({length: 27}, (_, i) => `${i + 1}번`).join('\n'),
                '모둠정하기': '1모둠\n2모둠\n3모둠\n4모둠\n5모둠\n6모둠'.split(',').join('\n'),
                '발표순서': '첫번째\n두번째\n세번째\n네번째\n다섯번째'.split(',').join('\n'),
                '간식뽑기': '사탕\n초콜릿\n젤리\n과자\n음료수\n아이스크림'.split(',').join('\n')
            };

            // 선택 모달 만들기
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4">
                    <h3 class="text-lg font-bold mb-4">저장된 목록 선택</h3>
                    <div class="space-y-2">
                        ${Object.keys(savedLists).map(key => `
                            <button onclick="loadPreset('${key}')" class="w-full text-left px-4 py-2 bg-gray-100 rounded hover:bg-gray-200">
                                ${key}
                            </button>
                        `).join('')}
                    </div>
                    <button onclick="this.closest('.fixed').remove()" class="mt-4 w-full bg-gray-500 text-white py-2 rounded hover:bg-gray-600">
                        취소
                    </button>
                </div>
            `;
            document.body.appendChild(modal);

            // 프리셋 로드 함수
            window.loadPreset = function(preset) {
                const lists = {
                    '번호뽑기': Array.from({length: 27}, (_, i) => `${i + 1}번`).join('\n'),
                    '모둠정하기': '1모둠\n2모둠\n3모둠\n4모둠\n5모둠\n6모둠',
                    '발표순서': '첫번째\n두번째\n세번째\n네번째\n다섯번째',
                    '간식뽑기': '사탕\n초콜릿\n젤리\n과자\n음료수\n아이스크림'
                };
                document.getElementById('wheelItems').value = lists[preset];
                updateWheelItems();
                modal.remove();
            };
        }

        // 결과 팝업 표시
        function showResultPopup(selectedItems) {
            const modal = document.getElementById('resultModal');
            const resultList = document.getElementById('resultList');
            
            // 결과 리스트 생성
            if (selectedItems.length === 1) {
                resultList.innerHTML = `
                    <div class="bg-gradient-to-r from-yellow-100 to-orange-100 rounded-lg p-6">
                        <div class="text-3xl font-bold text-gray-800 mb-2">${selectedItems[0]}</div>
                        <div class="text-sm text-gray-600">선택되었습니다!</div>
                    </div>
                `;
            } else {
                const itemsHtml = selectedItems.map((item, index) => `
                    <div class="bg-gradient-to-r from-blue-100 to-purple-100 rounded-lg p-4 mb-2">
                        <div class="text-xl font-bold text-gray-800">${index + 1}등: ${item}</div>
                    </div>
                `).join('');
                
                resultList.innerHTML = `
                    <div class="text-lg font-semibold text-gray-700 mb-4">${selectedItems.length}개가 선택되었습니다!</div>
                    ${itemsHtml}
                `;
            }
            
            // 모달 표시
            modal.classList.remove('hidden');
        }

        // 결과 모달 닫기
        function closeResultModal() {
            document.getElementById('resultModal').classList.add('hidden');
        }

        // textarea 변경 감지
        document.addEventListener('DOMContentLoaded', function() {
            const textarea = document.getElementById('wheelItems');
            if (textarea) {
                textarea.addEventListener('input', updateWheelItems);
            }
        });
    </script>

    <!-- Saved Lists Selection Modal -->
    <div id="savedListsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl max-w-md w-full p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-800">
                        <i class="fas fa-list text-yellow-500 mr-2"></i>저장된 목록 선택
                    </h3>
                    <button onclick="closeSavedListsModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                

                
                <!-- Lists Display -->
                <div id="modalSpinnerLists" class="space-y-2 max-h-60 overflow-y-auto mb-4">
                    <!-- Lists will be displayed here -->
                </div>
                
                <div class="flex space-x-2">
                    <button onclick="closeSavedListsModal()" 
                            class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition">
                        취소
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Result Popup Modal -->
    <div id="resultModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl max-w-lg w-full mx-4 p-6 transform transition-all duration-300">
            <div class="text-center">
                <div class="mb-4">
                    <i class="fas fa-trophy text-yellow-500 text-4xl mb-3"></i>
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">🎉 결과 발표!</h3>
                </div>
                
                <div id="resultList" class="mb-6">
                    <!-- Selected items will be displayed here -->
                </div>
                
                <button onclick="closeResultModal()" 
                        class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-8 py-3 rounded-lg font-semibold hover:opacity-90 transition">
                    <i class="fas fa-check mr-2"></i>확인
                </button>
            </div>
        </div>
    </div>
    
    <!-- Main Application -->
    <!-- Supabase Configuration -->
    <script src="js/supabase-config.js"></script>
    <script src="js/supabase-api.js"></script>
    <script src="js/main.js"></script>
</body>
</html>